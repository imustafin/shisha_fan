.\" -*- mode: troff; coding: UTF-8 -*-
.\" %%%LICENSE_START(PUBLIC_DOMAIN)
.\" This file is in the public domain, so clarified as of
.\" 1996-06-05 by Arthur David Olson <arthur_david_olson@nih.gov>.
.\" %%%LICENSE_END
.\"
.\"*******************************************************************
.\"
.\" This file was generated with po4a. Translate the source file.
.\"
.\"*******************************************************************
.TH TZFILE 5 2019\-03\-06 "" "Руководство программиста Linux"
.SH ИМЯ
tzfile \- информация о часовом поясе
.SH ОПИСАНИЕ
.ie  '\(lq'' .ds lq \&"\"
.el .ds lq \(lq\"
.ie  '\(rq'' .ds rq \&"\"
.el .ds rq \(rq\"
.de  q
\\$3\*(lq\\$1\*(rq\\$2
..
Файлы с информацией о часовых поясах, используемые \fBtzset\fP(3), обычно,
находятся в каталоге \fI/usr/share/zoneinfo\fP. Они начинаются с 44\-байтного
заголовка, содержащего следующие поля:
.IP * 2
Информационная (magic) четырехбайтовая последовательность ASCII
.q TZif
, означающая, что это файл с информацией о часовом поясе.
.IP *
Байт с версией формата файла (например 2017, ASCII NUL или
.q 2 ,
или
.q 3 ).
.IP *
Пятнадцать байт, заполненных нулями, зарезервированы для использования в
будущем.
.IP *
Шесть четырехбайтовых целых значений, записанных в стандартном  порядке байт
(старший байт значения записывается первым). Значения по порядку:
.RS
.TP 
\fItzh_ttisgmtcnt\fP
Количество UT/локальных (local) индикаторов в файле.
.TP 
\fItzh_ttisstdcnt\fP
Количество стандартных/местных (wall) индикаторов в файле.
.TP 
\fItzh_leapcnt\fP
Количество високосных секунд, для которых в файле определены элементы
данных.
.TP 
\fItzh_timecnt\fP
Количество моментов перевода часов, для которых в файле определены элементы
данных.
.TP 
\fItzh_typecnt\fP
Количество типов локального времени, для которых в файле определены элементы
данных (не должно быть равно 0).
.TP 
\fItzh_charcnt\fP
Количество байт строк аббревиатур часовых поясов, определённых в файле.
.RE
.PP
После заголовка, описанного выше, располагаются поля, длина которых зависит
от содержимого заголовка:
.IP * 2
Четырёхбайтовые знаковые целые \fItzh_timecnt\fP, сортируются в порядке
возрастания. Эти значения записываются в стандартном порядке байт. Каждое
значение используется как момент перевода часов (возвращаемый \fBtime\fP(2)),
по правилам которого вычисляется изменение локального времени.
.IP *
Однобайтовые беззнаковые целые \fItzh_timecnt\fP; все кроме последнего
описывают как различные типы типов локального времени, указанные в файле,
связаны с периодом времени, начинающимся как переходное время с тем же
индексом и перечисляются (исключая) до следующего переходного времени (тип
последнего времени указывается только для проверки целостности строки TZ в
формате POSIX, описанном ниже). Эти значения служат индексами для следующего
поля.
.IP *
Элементы \fItzh_typecnt\fP \fIttinfo\fP определены следующим образом:
.in +.5i
.sp
.nf
.ta .5i +\w'unsigned char\0\0'u
struct ttinfo {
	int32_t	tt_gmtoff;
	unsigned char	tt_isdst;
	unsigned char	tt_abbrind;
};
.in -.5i
.fi
.sp
Каждая структура состоит из четырехбайтного знакового числа \fItt_gmtoff\fP,
записанного в стандартном порядке байт; за ним следует однобайтное значение
\fItt_isdst\fP и однобайтное значение \fItt_abbrind\fP. В каждой структуре
\fItt_gmtoff\fP означает, сколько секунд надо добавить к UT; \fItt_isdst\fP
определяет, будет ли \fItm_isdst\fP устанавливаться \fBlocaltime\fP(3), а
\fItt_abbrind\fP является индексом массива аббревиатур байт часовых поясов, за
которым в файле следуют структуры \fIttinfo\fP.
.IP *
Пары четырехбайтных значений \fItzh_leapcnt\fP, записанные в стандартном
порядке байт; первое значение каждой пары задает неотрицательное время
(возвращаемое \fBtime\fP(2)) появления високосной секунды; вторая пара
определяет \fIобщее\fP количество високосных секунд, добавляемых во время
периода времени, начинающегося в указанное время. Пары значений
располагаются в порядке возрастания времени. Каждым переходом считается одна
високосная секунда, положительная  или отрицательная; переходы всегда
отстают друг от друга на не менее чем 28 дней минус 1 секунда.
.IP *
Индикаторы стандартного/местного времени \fItzh_ttisstdcnt\fP, хранимые в виде
однобайтовых значений; эти индикаторы определяют, как связаны моменты
перевода часов с локальными типами времени: согласно стандартному или
местному времени. Эти индикаторы используются, когда файл с информацией о
часовых поясах работает с POSIX\-совместимыми переменными окружения часовых
поясов.
.IP *
UT/локальные индикаторы \fItzh_ttisgmtcnt\fP, хранимые в виде однобайтовых
значений; эти индикаторы определяют, как связаны моменты перевода часов с
локальными типами времени: согласно UT или локальному времени. Эти
индикаторы используются, когда файл с информацией о часовых поясах работает
с POSIX\-совместимыми переменными окружения часовых поясов.
.PP
Функция \fIlocaltime\fP(3) использует первую структуру стандартного времени
\fIttinfo\fP из этого файла (или просто первую структуру \fIttinfo\fP при
отсутствии структуры стандартного времени), если значение \fItzh_timecnt\fP
равно нулю или аргумент времени меньше первого момента перевода часов,
записанного в файле.
.SS "Формат версии 2"
Для файлов версии 2 с информацией о часовых поясах вышеприведённый заголовок
и данные, идущие за вторым заголовком и данными, идентичны по формату, за
исключением того, что для каждого перевода времени или високосной секунды
используется восемь байт (високосная секунда занимает оставшиеся четыре
байта). После второго заголовка и данных следует закрывающий символ новой
строки, строка в формате переменной TZ из окружения POSIX для обработки
моментов сразу после последнего перевода времени, хранящегося в файле или
для всех моментов, если в файле нет переводов. Строка TZ в формате POSIX
будет пустой (т. е. между символами новой строки ничего нет), если для таких
моментов нет представления POSIX. Если она не пуста, то строка TZ в формате
POSIX должна соответствовать типу локального времени после обоих данных о
временах последнего перевода, если она представлена в виде восьми байтов
данных;  например, если задана строка
.q WET0WEST,M3.5.0,M10.5.0/3
то, если последний перевод времени был в июле, тип перевода локального
времени должен задаваться сокращением для времени перевода на зимнее время
.q WEST
то соответствует одному часу UT. Также, если есть хотя бы один перевод, то
тип времени 0 связывается с периодом времени из бесконечного прошлого до, но
исключая, самый ранний перевод времени.
.SS "Формат версии 3"
В формате файлов часовых поясов версии 3 в строке в стиле POSIX\-TZ можно
использовать два небольших расширения формата POSIX TZ, это описывается в
\fBnewtzset\fP(3). Во\-первых, часовая часть времён перевода может быть знаковой
и имеет диапазон с \-167 по 167, и не соответствовать беззнаковому значению
POSIX от 0 до 24. Во\-вторых, DST действует на весь год, если он начинается с
1 января 00:00 и заканчивается 31 декабря в 24:00 плюс разница между зимним
и обычным временем.
.PP
В будущих изменениях формата могут появиться дополнительные данные.
.SH "СМОТРИТЕ ТАКЖЕ"
\fBtime\fP(2), \fBlocaltime\fP(3), \fBtzset\fP(3), \fBtzselect\fP(8), \fBzdump\fP(8),
\fBzic\fP(8)
.\" This file is in the public domain, so clarified as of
.\" 1996-06-05 by Arthur David Olson.
